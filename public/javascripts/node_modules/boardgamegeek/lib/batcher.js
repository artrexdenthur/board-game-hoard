// TODO(schoon) - Support merging options, too.
function batcher(options) {
  var performAction = options.performAction || (() => {})
  var mergeArguments = options.mergeArguments || (() => {})
  var queue = []

  return {
    add(...args) {
      return new Promise((resolve) => queue.push({ args, resolve })
    },
    flush() {
      if (queue.length) {
        queue[0].resolve(performAction(queue[0].args))
        return
      }

      // TODO
      // queue.reduce(function (previousArguments, nextOp) {
      //   return merge()
      // })
    }
  }
}

module.exports = batcher
